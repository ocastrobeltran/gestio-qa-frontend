import{f as De,r as c,j as e,i as le,b as we,g as Ae,B as pe,Q as P}from"./index-CYuDxeVZ.js";import{C as N,a as C,b as D,c as F,d as w}from"./card-B2R_5Mvu.js";import{T as Ee,a as Se,b as k,c as L}from"./tabs-B4dp_e8w.js";import{S as X,a as Y,b as G,c as M,d as u}from"./select-BERQyZpp.js";import{L as T}from"./label-Bv7pHFfe.js";import{I as J}from"./input-DzyvJJh-.js";import{T as B,a as I,b as p,c as i,d as q,e as n,S as Te,F as Re}from"./table-gIOeb17S.js";import{A as _e,R as $,B as W,X as Z,Y as ee,T as K,L as te,a as se,C as me,P as Pe,b as Fe}from"./PieChart-h40Fwi3I.js";const ke=De("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),ye=c.forwardRef(({className:o,...g},m)=>e.jsx("div",{ref:m,className:le("relative w-full rounded-md border border-border bg-background p-4 text-foreground [&>[role=alert]]:ml-2",o),role:"alert",...g}));ye.displayName="Alert";const fe=c.forwardRef(({className:o,...g},m)=>e.jsx("h5",{ref:m,className:le("mb-1 font-semibold leading-none tracking-tight",o),...g}));fe.displayName="AlertTitle";const ge=c.forwardRef(({className:o,...g},m)=>e.jsx("div",{ref:m,className:le("text-sm [&_p]:leading-relaxed",o),...g}));ge.displayName="AlertDescription";const ae={"En análisis":"#3498db","En validación":"#f39c12","En pruebas":"#9b59b6",Aprobado:"#2ecc71",Cancelado:"#e74c3c"},j={statusReport:[{status:"En análisis",project_count:5},{status:"En validación",project_count:3},{status:"En pruebas",project_count:7},{status:"Aprobado",project_count:10},{status:"Cancelado",project_count:2}],analystReport:[{analyst:"Ana García",count:8},{analyst:"Carlos Pérez",count:6},{analyst:"María López",count:5},{analyst:"Sin asignar",count:3}],clientReport:[{client:"Empresa A",count:7},{client:"Empresa B",count:5},{client:"Empresa C",count:8},{client:"Empresa D",count:3}],detailedReport:[{id:1,title:"Proyecto Demo 1",initiative:"Iniciativa X",client:"Empresa A",status:"En análisis",qa_analyst:{full_name:"Ana García"},created_at:new Date().toISOString()},{id:2,title:"Proyecto Demo 2",initiative:"Iniciativa Y",client:"Empresa B",status:"Aprobado",qa_analyst:{full_name:"Carlos Pérez"},created_at:new Date().toISOString()}]},Oe=()=>{const{toast:o}=we(),[g,m]=c.useState(!0),[re,ne]=c.useState(null),[h,V]=c.useState([]),[v,H]=c.useState([]),[b,O]=c.useState([]),[y,U]=c.useState([]),[ve,be]=c.useState("status"),[r,ie]=c.useState({status:"",client:"",analyst:"",startDate:"",endDate:""}),[R,ce]=c.useState(""),[f,A]=c.useState([]);c.useEffect(()=>{(async()=>{var s,a,l,d,S,de,oe,he;try{m(!0),ne(null);let _,xe,ue,je;try{_=await P.getProjectsByStatus(),V(((a=(s=_.data)==null?void 0:s.data)==null?void 0:a.statusReport)||[])}catch(x){console.error("Error fetching status report:",x),V(j.statusReport)}try{xe=await P.getProjectsByAnalyst(),H(((d=(l=xe.data)==null?void 0:l.data)==null?void 0:d.analystReport)||[])}catch(x){console.error("Error fetching analyst report:",x),H(j.analystReport)}try{ue=await P.getProjectsByClient(),O(((de=(S=ue.data)==null?void 0:S.data)==null?void 0:de.clientReport)||[])}catch(x){console.error("Error fetching client report:",x),O(j.clientReport)}try{je=await P.getDetailedReport();const x=((he=(oe=je.data)==null?void 0:oe.data)==null?void 0:he.projects)||[];U(x),A(x)}catch(x){console.error("Error fetching detailed report:",x),U(j.detailedReport),A(j.detailedReport)}}catch(_){console.error("Error fetching report data:",_),ne("No se pudieron cargar los datos de los reportes. Usando datos de ejemplo."),V(j.statusReport),H(j.analystReport),O(j.clientReport),U(j.detailedReport),A(j.detailedReport),o({variant:"destructive",title:"Error",description:"No se pudieron cargar los datos de los reportes. Usando datos de ejemplo."})}finally{m(!1)}})()},[o]),c.useEffect(()=>{if(!y||!Array.isArray(y)){A([]);return}let t=[...y];if(r.status&&(t=t.filter(s=>s.status===r.status)),r.client&&(t=t.filter(s=>s.client===r.client)),r.analyst&&(t=t.filter(s=>{var a;return((a=s.qa_analyst)==null?void 0:a.full_name)===r.analyst||!s.qa_analyst&&r.analyst==="Sin asignar"})),r.startDate){const s=new Date(r.startDate);t=t.filter(a=>new Date(a.created_at)>=s)}if(r.endDate){const s=new Date(r.endDate);s.setHours(23,59,59,999),t=t.filter(a=>new Date(a.created_at)<=s)}if(R){const s=R.toLowerCase();t=t.filter(a=>{var l,d,S;return((l=a.title)==null?void 0:l.toLowerCase().includes(s))||((d=a.initiative)==null?void 0:d.toLowerCase().includes(s))||((S=a.client)==null?void 0:S.toLowerCase().includes(s))})}A(t)},[r,R,y]);const E=(t,s)=>{ie(a=>({...a,[t]:s}))},Ne=()=>{ie({status:"",client:"",analyst:"",startDate:"",endDate:""}),ce("")},Ce=()=>{if(!f||f.length===0){o({variant:"destructive",title:"Error",description:"No hay datos para exportar"});return}let t="data:text/csv;charset=utf-8,";t+=`ID,Título,Iniciativa,Cliente,Estado,Analista QA,Fecha Creación
`,f.forEach(l=>{const d=[l.id,`"${(l.title||"").replace(/"/g,'""')}"`,`"${(l.initiative||"").replace(/"/g,'""')}"`,`"${(l.client||"").replace(/"/g,'""')}"`,l.status||"",l.qa_analyst?`"${l.qa_analyst.full_name.replace(/"/g,'""')}"`:"Sin asignar",l.created_at?new Date(l.created_at).toLocaleDateString():""];t+=d.join(",")+`
`});const s=encodeURI(t),a=document.createElement("a");a.setAttribute("href",s),a.setAttribute("download",`reporte-proyectos-${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(a),a.click(),document.body.removeChild(a),o({title:"Reporte exportado",description:"El reporte ha sido exportado exitosamente."})};if(g)return e.jsx(Ae,{fullScreen:!1});const z=Array.isArray(y)?Array.from(new Set(y.map(t=>t.client).filter(Boolean))):[],Q=Array.isArray(y)?Array.from(new Set(y.map(t=>t.qa_analyst?t.qa_analyst.full_name:"Sin asignar").filter(Boolean))):[];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Reportes"})}),re&&e.jsxs(ye,{className:"bg-destructive/15 text-destructive",children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx(fe,{children:"Error"}),e.jsx(ge,{children:re})]}),e.jsxs(Ee,{defaultValue:"status",value:ve,onValueChange:be,children:[e.jsxs(Se,{children:[e.jsx(k,{value:"status",children:"Por Estado"}),e.jsx(k,{value:"analyst",children:"Por Analista"}),e.jsx(k,{value:"client",children:"Por Cliente"}),e.jsx(k,{value:"detailed",children:"Detallado"})]}),e.jsxs(L,{value:"status",className:"space-y-4",children:[e.jsxs(N,{children:[e.jsxs(C,{children:[e.jsx(D,{children:"Proyectos por Estado"}),e.jsx(F,{children:"Distribución de proyectos según su estado actual"})]}),e.jsx(w,{className:"grid gap-4 md:grid-cols-2",children:h&&h.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx($,{width:"100%",height:300,children:e.jsxs(W,{data:h,children:[e.jsx(Z,{dataKey:"status"}),e.jsx(ee,{allowDecimals:!1}),e.jsx(K,{}),e.jsx(te,{}),e.jsx(se,{dataKey:"project_count",name:"Proyectos",fill:"#ff5252",children:h.map((t,s)=>e.jsx(me,{fill:ae[t.status]||"#ff5252"},`cell-${s}`))})]})})}),e.jsx("div",{children:e.jsx($,{width:"100%",height:300,children:e.jsxs(Pe,{children:[e.jsx(Fe,{data:h,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"project_count",nameKey:"status",label:({name:t,percent:s})=>`${t}: ${(s*100).toFixed(0)}%`,children:h.map((t,s)=>e.jsx(me,{fill:ae[t.status]||"#ff5252"},`cell-${s}`))}),e.jsx(K,{})]})})})]}):e.jsx("div",{className:"col-span-2 flex justify-center items-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"No hay datos disponibles"})})})]}),e.jsxs(N,{children:[e.jsx(C,{children:e.jsx(D,{children:"Tabla de Proyectos por Estado"})}),e.jsx(w,{children:h&&h.length>0?e.jsxs(B,{children:[e.jsx(I,{children:e.jsxs(p,{children:[e.jsx(i,{children:"Estado"}),e.jsx(i,{className:"text-right",children:"Cantidad"}),e.jsx(i,{className:"text-right",children:"Porcentaje"})]})}),e.jsx(q,{children:h.map(t=>{const s=h.reduce((l,d)=>l+d.project_count,0),a=(t.project_count/s*100).toFixed(1);return e.jsxs(p,{children:[e.jsx(n,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:ae[t.status]||"#ff5252"}}),t.status]})}),e.jsx(n,{className:"text-right",children:t.project_count}),e.jsxs(n,{className:"text-right",children:[a,"%"]})]},t.status)})})]}):e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("p",{className:"text-muted-foreground",children:"No hay datos disponibles"})})})]})]}),e.jsxs(L,{value:"analyst",className:"space-y-4",children:[e.jsxs(N,{children:[e.jsxs(C,{children:[e.jsx(D,{children:"Proyectos por Analista"}),e.jsx(F,{children:"Distribución de proyectos asignados a cada analista QA"})]}),e.jsx(w,{children:v&&v.length>0?e.jsx($,{width:"100%",height:400,children:e.jsxs(W,{data:v,layout:"vertical",margin:{left:120},children:[e.jsx(Z,{type:"number"}),e.jsx(ee,{type:"category",dataKey:"analyst",width:120}),e.jsx(K,{}),e.jsx(te,{}),e.jsx(se,{dataKey:"count",name:"Proyectos",fill:"#ff5252"})]})}):e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"No hay datos disponibles"})})})]}),e.jsxs(N,{children:[e.jsx(C,{children:e.jsx(D,{children:"Tabla de Proyectos por Analista"})}),e.jsx(w,{children:v&&v.length>0?e.jsxs(B,{children:[e.jsx(I,{children:e.jsxs(p,{children:[e.jsx(i,{children:"Analista"}),e.jsx(i,{className:"text-right",children:"Cantidad"}),e.jsx(i,{className:"text-right",children:"Porcentaje"})]})}),e.jsx(q,{children:v.map(t=>{const s=v.reduce((l,d)=>l+d.count,0),a=(t.count/s*100).toFixed(1);return e.jsxs(p,{children:[e.jsx(n,{className:"font-medium",children:t.analyst}),e.jsx(n,{className:"text-right",children:t.count}),e.jsxs(n,{className:"text-right",children:[a,"%"]})]},t.analyst)})})]}):e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("p",{className:"text-muted-foreground",children:"No hay datos disponibles"})})})]})]}),e.jsxs(L,{value:"client",className:"space-y-4",children:[e.jsxs(N,{children:[e.jsxs(C,{children:[e.jsx(D,{children:"Proyectos por Cliente"}),e.jsx(F,{children:"Distribución de proyectos por cliente"})]}),e.jsx(w,{children:b&&b.length>0?e.jsx($,{width:"100%",height:400,children:e.jsxs(W,{data:b,layout:"vertical",margin:{left:120},children:[e.jsx(Z,{type:"number"}),e.jsx(ee,{type:"category",dataKey:"client",width:120}),e.jsx(K,{}),e.jsx(te,{}),e.jsx(se,{dataKey:"count",name:"Proyectos",fill:"#3498db"})]})}):e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"No hay datos disponibles"})})})]}),e.jsxs(N,{children:[e.jsx(C,{children:e.jsx(D,{children:"Tabla de Proyectos por Cliente"})}),e.jsx(w,{children:b&&b.length>0?e.jsxs(B,{children:[e.jsx(I,{children:e.jsxs(p,{children:[e.jsx(i,{children:"Cliente"}),e.jsx(i,{className:"text-right",children:"Cantidad"}),e.jsx(i,{className:"text-right",children:"Porcentaje"})]})}),e.jsx(q,{children:b.map(t=>{const s=b.reduce((l,d)=>l+d.count,0),a=(t.count/s*100).toFixed(1);return e.jsxs(p,{children:[e.jsx(n,{className:"font-medium",children:t.client}),e.jsx(n,{className:"text-right",children:t.count}),e.jsxs(n,{className:"text-right",children:[a,"%"]})]},t.client)})})]}):e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("p",{className:"text-muted-foreground",children:"No hay datos disponibles"})})})]})]}),e.jsx(L,{value:"detailed",className:"space-y-4",children:e.jsxs(N,{children:[e.jsxs(C,{children:[e.jsx(D,{children:"Reporte Detallado"}),e.jsx(F,{children:"Listado completo de proyectos con filtros avanzados"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Te,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(J,{type:"search",placeholder:"Buscar por título, cliente o iniciativa...",className:"pl-8",value:R,onChange:t=>ce(t.target.value)})]}),e.jsxs(pe,{variant:"outline",onClick:Ce,disabled:!f||f.length===0,children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Exportar CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"status-filter",children:"Estado"}),e.jsxs(X,{value:r.status,onValueChange:t=>E("status",t),children:[e.jsx(Y,{id:"status-filter",children:e.jsx(G,{placeholder:"Todos los estados"})}),e.jsxs(M,{children:[e.jsx(u,{value:"all",children:"Todos los estados"}),e.jsx(u,{value:"En análisis",children:"En análisis"}),e.jsx(u,{value:"En validación",children:"En validación"}),e.jsx(u,{value:"En pruebas",children:"En pruebas"}),e.jsx(u,{value:"Aprobado",children:"Aprobado"}),e.jsx(u,{value:"Cancelado",children:"Cancelado"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"client-filter",children:"Cliente"}),e.jsxs(X,{value:r.client,onValueChange:t=>E("client",t),children:[e.jsx(Y,{id:"client-filter",children:e.jsx(G,{placeholder:"Todos los clientes"})}),e.jsxs(M,{children:[e.jsx(u,{value:"all",children:"Todos los clientes"}),z&&z.length>0&&z.map(t=>e.jsx(u,{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"analyst-filter",children:"Analista"}),e.jsxs(X,{value:r.analyst,onValueChange:t=>E("analyst",t),children:[e.jsx(Y,{id:"analyst-filter",children:e.jsx(G,{placeholder:"Todos los analistas"})}),e.jsxs(M,{children:[e.jsx(u,{value:"all",children:"Todos los analistas"}),Q&&Q.length>0&&Q.map(t=>e.jsx(u,{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"start-date",children:"Fecha Inicio"}),e.jsx(J,{id:"start-date",type:"date",value:r.startDate,onChange:t=>E("startDate",t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"end-date",children:"Fecha Fin"}),e.jsx(J,{id:"end-date",type:"date",value:r.endDate,onChange:t=>E("endDate",t.target.value)})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(pe,{variant:"outline",onClick:Ne,children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Limpiar Filtros"]})}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(B,{children:[e.jsx(I,{children:e.jsxs(p,{children:[e.jsx(i,{children:"ID"}),e.jsx(i,{children:"Título"}),e.jsx(i,{children:"Cliente"}),e.jsx(i,{children:"Estado"}),e.jsx(i,{children:"Analista QA"}),e.jsx(i,{children:"Fecha Creación"})]})}),e.jsx(q,{children:f&&f.length>0?f.map(t=>{var s;return e.jsxs(p,{children:[e.jsx(n,{children:t.id}),e.jsx(n,{className:"font-medium",children:t.title}),e.jsx(n,{children:t.client}),e.jsx(n,{children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${t.status==="Aprobado"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":t.status==="Cancelado"?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300":t.status==="En pruebas"?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300":t.status==="En validación"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"}`,children:t.status})}),e.jsx(n,{children:((s=t.qa_analyst)==null?void 0:s.full_name)||"Sin asignar"}),e.jsx(n,{children:t.created_at?new Date(t.created_at).toLocaleDateString():""})]},t.id)}):e.jsx(p,{children:e.jsx(n,{colSpan:6,className:"h-24 text-center",children:"No se encontraron proyectos con los filtros aplicados"})})})]})})]})]})})]})]})};export{Oe as default};
