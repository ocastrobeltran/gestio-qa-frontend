import{f as E,u as Y,r as i,j as e,g as H,B as I,L as S,h as Q,U as J,p as W,i as y}from"./index-CROi_bFZ.js";import{C as l,a as r,b as c,d as n,c as b}from"./card-B-0H7GP8.js";import{T as Z,a as ee,b as g,c as N}from"./tabs-wem10j3N.js";import{P as se}from"./plus-C9L6BQP6.js";import{C as te}from"./clock-Cu56niOf.js";import{R as h,B as v,X as w,Y as P,T as m,L as C,a as D,C as R,P as ae,b as le}from"./PieChart-oqfcXHWS.js";const re=E("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),ce=E("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),T={"En análisis":"#3498db","En validación":"#f39c12","En pruebas":"#9b59b6",Aprobado:"#2ecc71",Cancelado:"#e74c3c"},me=()=>{const{user:a}=Y(),[L,k]=i.useState(!0),[j,B]=i.useState([]),[o,_]=i.useState([]),[K,$]=i.useState([]),[q,z]=i.useState([]),[A,U]=i.useState([]),[V,F]=i.useState("overview"),d=(a==null?void 0:a.role)==="admin",u=(a==null?void 0:a.role)==="analyst";if(i.useEffect(()=>{(async()=>{try{k(!0);const t=await W.getProjects();B(t.data.data.projects);const O=[...t.data.data.projects].sort((f,p)=>new Date(p.updated_at).getTime()-new Date(f.updated_at).getTime()).slice(0,5);U(O);const X=await y.getProjectsByStatus();if(_(X.data.data.statusReport),d){const f=await y.getProjectsByAnalyst();$(f.data.data.analystReport);const p=await y.getProjectsByClient();z(p.data.data.clientReport)}}catch(t){console.error("Error fetching dashboard data:",t)}finally{k(!1)}})()},[d]),L)return e.jsx(H,{fullScreen:!1});const G=j.length,x=j.reduce((s,t)=>(s[t.status]=(s[t.status]||0)+1,s),{}),M=u?j.filter(s=>s.qa_analyst_id===(a==null?void 0:a.id)||s.created_by===(a==null?void 0:a.id)):[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Dashboard"}),(d||u)&&e.jsx(I,{asChild:!0,children:e.jsxs(S,{to:"/projects/create",children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Nuevo Proyecto"]})})]}),e.jsxs(Z,{defaultValue:"overview",value:V,onValueChange:F,children:[e.jsxs(ee,{children:[e.jsx(g,{value:"overview",children:"Resumen"}),e.jsx(g,{value:"charts",children:"Gráficos"}),e.jsx(g,{value:"recent",children:"Proyectos Recientes"})]}),e.jsxs(N,{value:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Total Proyectos"}),e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:G}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Proyectos en el sistema"})]})]}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"En Pruebas"}),e.jsx(te,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x["En pruebas"]||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Proyectos en fase de pruebas"})]})]}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Aprobados"}),e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.Aprobado||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Proyectos aprobados"})]})]}),u?e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Mis Proyectos"}),e.jsx(J,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:M.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Proyectos asignados a ti"})]})]}):e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Pendientes"}),e.jsx(re,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(x["En análisis"]||0)+(x["En validación"]||0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Proyectos pendientes de completar"})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[e.jsxs(l,{className:"col-span-4",children:[e.jsx(r,{children:e.jsx(c,{children:"Proyectos por Estado"})}),e.jsx(n,{className:"pl-2",children:e.jsx(h,{width:"100%",height:300,children:e.jsxs(v,{data:o,children:[e.jsx(w,{dataKey:"status"}),e.jsx(P,{allowDecimals:!1}),e.jsx(m,{}),e.jsx(C,{}),e.jsx(D,{dataKey:"project_count",name:"Proyectos",fill:"#ff5252",children:o.map((s,t)=>e.jsx(R,{fill:T[s.status]||"#ff5252"},`cell-${t}`))})]})})})]}),e.jsxs(l,{className:"col-span-3",children:[e.jsx(r,{children:e.jsx(c,{children:"Distribución de Estados"})}),e.jsx(n,{children:e.jsx(h,{width:"100%",height:300,children:e.jsxs(ae,{children:[e.jsx(le,{data:o,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"project_count",nameKey:"status",label:({name:s,percent:t})=>`${s}: ${(t*100).toFixed(0)}%`,children:o.map((s,t)=>e.jsx(R,{fill:T[s.status]||"#ff5252"},`cell-${t}`))}),e.jsx(m,{})]})})})]})]})]}),e.jsxs(N,{value:"charts",className:"space-y-4",children:[d&&e.jsxs(e.Fragment,{children:[e.jsxs(l,{children:[e.jsxs(r,{children:[e.jsx(c,{children:"Proyectos por Analista"}),e.jsx(b,{children:"Distribución de proyectos asignados a cada analista QA"})]}),e.jsx(n,{className:"pl-2",children:e.jsx(h,{width:"100%",height:300,children:e.jsxs(v,{data:K,children:[e.jsx(w,{dataKey:"analyst"}),e.jsx(P,{allowDecimals:!1}),e.jsx(m,{}),e.jsx(C,{}),e.jsx(D,{dataKey:"count",name:"Proyectos",fill:"#ff5252"})]})})})]}),e.jsxs(l,{children:[e.jsxs(r,{children:[e.jsx(c,{children:"Proyectos por Cliente"}),e.jsx(b,{children:"Distribución de proyectos por cliente"})]}),e.jsx(n,{className:"pl-2",children:e.jsx(h,{width:"100%",height:300,children:e.jsxs(v,{data:q,children:[e.jsx(w,{dataKey:"client"}),e.jsx(P,{allowDecimals:!1}),e.jsx(m,{}),e.jsx(C,{}),e.jsx(D,{dataKey:"count",name:"Proyectos",fill:"#3498db"})]})})})]})]}),!d&&e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx("p",{className:"text-muted-foreground",children:"Gráficos adicionales disponibles para administradores"})})]}),e.jsx(N,{value:"recent",className:"space-y-4",children:e.jsxs(l,{children:[e.jsxs(r,{children:[e.jsx(c,{children:"Proyectos Recientes"}),e.jsx(b,{children:"Los últimos proyectos actualizados en el sistema"})]}),e.jsx(n,{children:A.length>0?e.jsx("div",{className:"space-y-4",children:A.map(s=>e.jsxs("div",{className:"flex items-center justify-between border-b pb-4 last:border-0 last:pb-0",children:[e.jsxs("div",{children:[e.jsx(S,{to:`/projects/${s.id}`,className:"font-medium hover:underline",children:s.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Cliente: ",s.client]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Actualizado: ",new Date(s.updated_at).toLocaleDateString()]})]}),e.jsx("div",{children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${s.status==="Aprobado"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":s.status==="Cancelado"?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300":s.status==="En pruebas"?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300":s.status==="En validación"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"}`,children:s.status})})]},s.id))}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-muted-foreground",children:"No hay proyectos recientes"})})})]})})]})]})};export{me as default};
