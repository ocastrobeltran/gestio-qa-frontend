import{d as Y,e as Z,u as ee,b as se,r as j,j as e,g as ae,B as m,L as F,p as C,t as te}from"./index-CYuDxeVZ.js";import{I as o}from"./input-DzyvJJh-.js";import{L as d}from"./label-Bv7pHFfe.js";import{S as I,a as R,b as z,c as T,d as v}from"./select-BERQyZpp.js";import{C as b,a as E,b as A,c as D,d as S}from"./card-B2R_5Mvu.js";import{A as re,a as ie,b as le,c as ne,d as de,e as oe,f as ce,g as pe,h as ue}from"./alert-dialog-CCO2wZaf.js";import{A as he}from"./arrow-left-D5phPwFc.js";import{T as _}from"./trash-DzscaxT7.js";import{P as k}from"./plus-adGqTkVZ.js";const be=()=>{const{id:n}=Y(),x=Z(),{user:c}=ee(),{toast:p}=se(),[y,P]=j.useState(!0),[q,g]=j.useState(!1),[f,U]=j.useState(null),[V,$]=j.useState([]),[s,u]=j.useState({title:"",initiative:"",client:"",pm:"",lead_dev:"",designer:"",design_url:"",test_url:"",qa_analyst_id:"",status:"",developers:[{id:0,project_id:0,developer_name:""}],assets:[{id:0,project_id:0,asset_url:""}]}),N=(c==null?void 0:c.role)==="admin",w=(c==null?void 0:c.role)==="analyst";j.useEffect(()=>{(async()=>{var t,r;try{P(!0);const l=(await C.getProject(n)).data.data.project,O=(await te.getUsers()).data.data.users.filter(X=>X.role==="analyst");U(l),$(O),u({title:l.title,initiative:l.initiative,client:l.client,pm:l.pm,lead_dev:l.lead_dev,designer:l.designer||"",design_url:l.design_url||"",test_url:l.test_url||"",qa_analyst_id:l.qa_analyst_id?l.qa_analyst_id.toString():"",status:l.status,developers:(t=l.developers)!=null&&t.length?l.developers:[{id:0,project_id:Number.parseInt(n),developer_name:""}],assets:(r=l.assets)!=null&&r.length?l.assets:[{id:0,project_id:Number.parseInt(n),asset_url:""}]})}catch(i){console.error("Error fetching data:",i),p({variant:"destructive",title:"Error",description:"No se pudo cargar la información del proyecto."}),x("/projects")}finally{P(!1)}})()},[n,x,p]),j.useEffect(()=>{!y&&f&&c&&(N||w&&f.qa_analyst_id===c.id||(p({variant:"destructive",title:"Acceso denegado",description:"No tienes permisos para editar este proyecto."}),x(`/projects/${n}`)))},[y,f,c,N,w,n,x,p]);const h=a=>{const{name:t,value:r}=a.target;u(i=>({...i,[t]:r}))},L=(a,t)=>{u(r=>({...r,[a]:t}))},B=(a,t)=>{const r=[...s.developers];r[a].developer_name=t,u(i=>({...i,developers:r}))},G=(a,t)=>{const r=[...s.assets];r[a].asset_url=t,u(i=>({...i,assets:r}))},M=()=>{u(a=>({...a,developers:[...a.developers,{id:0,project_id:Number.parseInt(n),developer_name:""}]}))},H=a=>{if(s.developers.length===1)return;const t=[...s.developers];t.splice(a,1),u(r=>({...r,developers:t}))},Q=()=>{u(a=>({...a,assets:[...a.assets,{id:0,project_id:Number.parseInt(n),asset_url:""}]}))},W=a=>{if(s.assets.length===1)return;const t=[...s.assets];t.splice(a,1),u(r=>({...r,assets:t}))},J=async a=>{if(a.preventDefault(),!s.title||!s.initiative||!s.client||!s.pm||!s.lead_dev){p({variant:"destructive",title:"Error",description:"Por favor completa todos los campos requeridos."});return}const t=s.developers.filter(i=>i.developer_name.trim()!=="").map(i=>i.developer_name),r=s.assets.filter(i=>i.asset_url.trim()!=="").map(i=>i.asset_url);try{g(!0);const i={title:s.title,initiative:s.initiative,client:s.client,pm:s.pm,lead_dev:s.lead_dev,designer:s.designer,design_url:s.design_url,test_url:s.test_url,qa_analyst_id:s.qa_analyst_id||null,status:s.status,developers:t,assets:r};console.log("Enviando datos para actualizar:",i),await C.updateProject(n,i),p({title:"Proyecto actualizado",description:"El proyecto ha sido actualizado exitosamente."}),x(`/projects/${n}`)}catch(i){console.error("Error updating project:",i),p({variant:"destructive",title:"Error",description:"No se pudo actualizar el proyecto. Inténtalo de nuevo."})}finally{g(!1)}},K=async()=>{try{g(!0),await C.deleteProject(n),p({title:"Proyecto eliminado",description:"El proyecto ha sido eliminado exitosamente."}),x("/projects")}catch(a){console.error("Error deleting project:",a),p({variant:"destructive",title:"Error",description:"No se pudo eliminar el proyecto. Inténtalo de nuevo."}),g(!1)}};return y?e.jsx(ae,{fullScreen:!1}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{variant:"ghost",size:"sm",asChild:!0,className:"mr-2",children:e.jsxs(F,{to:`/projects/${n}`,children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"Volver"]})}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Editar Proyecto"})]}),N&&e.jsxs(re,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs(m,{variant:"destructive",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Eliminar Proyecto"]})}),e.jsxs(le,{children:[e.jsxs(ne,{children:[e.jsx(de,{children:"¿Estás seguro?"}),e.jsx(oe,{children:"Esta acción no se puede deshacer. Se eliminará permanentemente el proyecto y todos sus datos asociados."})]}),e.jsxs(ce,{children:[e.jsx(pe,{children:"Cancelar"}),e.jsxs(ue,{onClick:K,className:"bg-destructive text-destructive-foreground",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Eliminar"]})]})]})]})]}),e.jsx("form",{onSubmit:J,children:e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(b,{children:[e.jsxs(E,{children:[e.jsx(A,{children:"Información General"}),e.jsx(D,{children:"Actualiza la información básica del proyecto"})]}),e.jsx(S,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"title",children:"Título del Proyecto *"}),e.jsx(o,{id:"title",name:"title",value:s.title,onChange:h,placeholder:"Ej: Rediseño Portal Web",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"initiative",children:"Iniciativa *"}),e.jsx(o,{id:"initiative",name:"initiative",value:s.initiative,onChange:h,placeholder:"Ej: Mejora Experiencia Usuario",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"client",children:"Cliente *"}),e.jsx(o,{id:"client",name:"client",value:s.client,onChange:h,placeholder:"Ej: Empresa ABC",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"status",children:"Estado"}),e.jsxs(I,{value:s.status,onValueChange:a=>L("status",a),children:[e.jsx(R,{children:e.jsx(z,{placeholder:"Selecciona un estado"})}),e.jsxs(T,{children:[e.jsx(v,{value:"En análisis",children:"En análisis"}),e.jsx(v,{value:"En validación",children:"En validación"}),e.jsx(v,{value:"En pruebas",children:"En pruebas"}),e.jsx(v,{value:"Aprobado",children:"Aprobado"}),e.jsx(v,{value:"Cancelado",children:"Cancelado"})]})]})]})]})})]}),e.jsxs(b,{children:[e.jsxs(E,{children:[e.jsx(A,{children:"Equipo del Proyecto"}),e.jsx(D,{children:"Información sobre el equipo asignado"})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"pm",children:"Project Manager *"}),e.jsx(o,{id:"pm",name:"pm",value:s.pm,onChange:h,placeholder:"Nombre del PM",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"lead_dev",children:"Lead Developer *"}),e.jsx(o,{id:"lead_dev",name:"lead_dev",value:s.lead_dev,onChange:h,placeholder:"Nombre del Lead Developer",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"designer",children:"Diseñador"}),e.jsx(o,{id:"designer",name:"designer",value:s.designer,onChange:h,placeholder:"Nombre del Diseñador"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"qa_analyst_id",children:"Analista QA"}),e.jsxs(I,{value:s.qa_analyst_id,onValueChange:a=>L("qa_analyst_id",a),children:[e.jsx(R,{children:e.jsx(z,{placeholder:"Selecciona un analista"})}),e.jsxs(T,{children:[e.jsx(v,{value:"0",children:"Sin asignar"}),V.map(a=>e.jsx(v,{value:a.id.toString(),children:a.full_name},a.id))]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{children:"Desarrolladores"}),e.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:M,children:[e.jsx(k,{className:"h-4 w-4 mr-1"}),"Añadir"]})]}),s.developers.map((a,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{value:a.developer_name,onChange:r=>B(t,r.target.value),placeholder:"Nombre del desarrollador"}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",onClick:()=>H(t),disabled:s.developers.length===1,children:e.jsx(_,{className:"h-4 w-4 text-destructive"})})]},t))]})]})]}),e.jsxs(b,{children:[e.jsxs(E,{children:[e.jsx(A,{children:"Enlaces y Recursos"}),e.jsx(D,{children:"URLs y recursos relacionados con el proyecto"})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"design_url",children:"URL de Diseño"}),e.jsx(o,{id:"design_url",name:"design_url",value:s.design_url,onChange:h,placeholder:"https://figma.com/..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"test_url",children:"URL de Pruebas"}),e.jsx(o,{id:"test_url",name:"test_url",value:s.test_url,onChange:h,placeholder:"https://staging.example.com"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{children:"Recursos Adicionales"}),e.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:Q,children:[e.jsx(k,{className:"h-4 w-4 mr-1"}),"Añadir"]})]}),s.assets.map((a,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{value:a.asset_url,onChange:r=>G(t,r.target.value),placeholder:"URL del recurso"}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",onClick:()=>W(t),disabled:s.assets.length===1,children:e.jsx(_,{className:"h-4 w-4 text-destructive"})})]},t))]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(m,{variant:"outline",type:"button",asChild:!0,children:e.jsx(F,{to:`/projects/${n}`,children:"Cancelar"})}),e.jsx(m,{type:"submit",disabled:q,children:q?"Guardando...":"Guardar Cambios"})]})]})})]})};export{be as default};
