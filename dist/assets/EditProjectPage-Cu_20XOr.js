import{d as Y,e as Z,u as ee,b as se,r as j,j as e,g as ae,B as m,L as F,p as C,v as te}from"./index-CROi_bFZ.js";import{I as d}from"./input-BF63-rU5.js";import{L as o}from"./label-kHtJxQ_W.js";import{S as I,a as R,b as z,c as T,d as v}from"./select-B-rD1Ibz.js";import{C as b,a as E,b as A,c as D,d as S}from"./card-B-0H7GP8.js";import{A as re,a as le,b as ie,c as ne,d as oe,e as de,f as ce,g as pe,h as he}from"./alert-dialog-AYtEr9F3.js";import{A as ue}from"./arrow-left-BPDy95mI.js";import{T as y}from"./trash-ChFt8LWx.js";import{P as k}from"./plus-C9L6BQP6.js";const be=()=>{const{id:n}=Y(),x=Z(),{user:c}=ee(),{toast:p}=se(),[f,P]=j.useState(!0),[q,g]=j.useState(!1),[_,U]=j.useState(null),[V,$]=j.useState([]),[a,h]=j.useState({title:"",initiative:"",client:"",pm:"",lead_dev:"",designer:"",design_url:"",test_url:"",qa_analyst_id:"",status:"",developers:[{id:0,project_id:0,developer_name:""}],assets:[{id:0,project_id:0,asset_url:""}]}),N=(c==null?void 0:c.role)==="admin",w=(c==null?void 0:c.role)==="analyst";j.useEffect(()=>{(async()=>{var t,r;try{P(!0);const i=(await C.getProject(n)).data.data.project,O=(await te.getUsers()).data.data.users.filter(X=>X.role==="analyst");U(i),$(O),h({title:i.title,initiative:i.initiative,client:i.client,pm:i.pm,lead_dev:i.lead_dev,designer:i.designer||"",design_url:i.design_url||"",test_url:i.test_url||"",qa_analyst_id:i.qa_analyst_id?i.qa_analyst_id.toString():"",status:i.status,developers:(t=i.developers)!=null&&t.length?i.developers:[{id:0,project_id:Number.parseInt(n),developer_name:""}],assets:(r=i.assets)!=null&&r.length?i.assets:[{id:0,project_id:Number.parseInt(n),asset_url:""}]})}catch(l){console.error("Error fetching data:",l),p({variant:"destructive",title:"Error",description:"No se pudo cargar la información del proyecto."}),x("/projects")}finally{P(!1)}})()},[n,x,p]),j.useEffect(()=>{!f&&_&&c&&(N||w&&_.qa_analyst_id===c.id||(p({variant:"destructive",title:"Acceso denegado",description:"No tienes permisos para editar este proyecto."}),x(`/projects/${n}`)))},[f,_,c,N,w,n,x,p]);const u=s=>{const{name:t,value:r}=s.target;h(l=>({...l,[t]:r}))},L=(s,t)=>{h(r=>({...r,[s]:t}))},B=(s,t)=>{const r=[...a.developers];r[s].developer_name=t,h(l=>({...l,developers:r}))},G=(s,t)=>{const r=[...a.assets];r[s].asset_url=t,h(l=>({...l,assets:r}))},M=()=>{h(s=>({...s,developers:[...s.developers,{id:0,project_id:Number.parseInt(n),developer_name:""}]}))},H=s=>{if(a.developers.length===1)return;const t=[...a.developers];t.splice(s,1),h(r=>({...r,developers:t}))},Q=()=>{h(s=>({...s,assets:[...s.assets,{id:0,project_id:Number.parseInt(n),asset_url:""}]}))},W=s=>{if(a.assets.length===1)return;const t=[...a.assets];t.splice(s,1),h(r=>({...r,assets:t}))},J=async s=>{if(s.preventDefault(),!a.title||!a.initiative||!a.client||!a.pm||!a.lead_dev){p({variant:"destructive",title:"Error",description:"Por favor completa todos los campos requeridos."});return}const t=a.developers.filter(l=>l.developer_name.trim()!==""),r=a.assets.filter(l=>l.asset_url.trim()!=="");try{g(!0);const l={...a,developers:t,assets:r,qa_analyst_id:a.qa_analyst_id||null};await C.updateProject(n,l),p({title:"Proyecto actualizado",description:"El proyecto ha sido actualizado exitosamente."}),x(`/projects/${n}`)}catch(l){console.error("Error updating project:",l),p({variant:"destructive",title:"Error",description:"No se pudo actualizar el proyecto. Inténtalo de nuevo."})}finally{g(!1)}},K=async()=>{try{g(!0),await C.deleteProject(n),p({title:"Proyecto eliminado",description:"El proyecto ha sido eliminado exitosamente."}),x("/projects")}catch(s){console.error("Error deleting project:",s),p({variant:"destructive",title:"Error",description:"No se pudo eliminar el proyecto. Inténtalo de nuevo."}),g(!1)}};return f?e.jsx(ae,{fullScreen:!1}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{variant:"ghost",size:"sm",asChild:!0,className:"mr-2",children:e.jsxs(F,{to:`/projects/${n}`,children:[e.jsx(ue,{className:"h-4 w-4 mr-1"}),"Volver"]})}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Editar Proyecto"})]}),N&&e.jsxs(re,{children:[e.jsx(le,{asChild:!0,children:e.jsxs(m,{variant:"destructive",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Eliminar Proyecto"]})}),e.jsxs(ie,{children:[e.jsxs(ne,{children:[e.jsx(oe,{children:"¿Estás seguro?"}),e.jsx(de,{children:"Esta acción no se puede deshacer. Se eliminará permanentemente el proyecto y todos sus datos asociados."})]}),e.jsxs(ce,{children:[e.jsx(pe,{children:"Cancelar"}),e.jsxs(he,{onClick:K,className:"bg-destructive text-destructive-foreground",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Eliminar"]})]})]})]})]}),e.jsx("form",{onSubmit:J,children:e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(b,{children:[e.jsxs(E,{children:[e.jsx(A,{children:"Información General"}),e.jsx(D,{children:"Actualiza la información básica del proyecto"})]}),e.jsx(S,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"title",children:"Título del Proyecto *"}),e.jsx(d,{id:"title",name:"title",value:a.title,onChange:u,placeholder:"Ej: Rediseño Portal Web",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"initiative",children:"Iniciativa *"}),e.jsx(d,{id:"initiative",name:"initiative",value:a.initiative,onChange:u,placeholder:"Ej: Mejora Experiencia Usuario",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"client",children:"Cliente *"}),e.jsx(d,{id:"client",name:"client",value:a.client,onChange:u,placeholder:"Ej: Empresa ABC",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"status",children:"Estado"}),e.jsxs(I,{value:a.status,onValueChange:s=>L("status",s),children:[e.jsx(R,{children:e.jsx(z,{placeholder:"Selecciona un estado"})}),e.jsxs(T,{children:[e.jsx(v,{value:"En análisis",children:"En análisis"}),e.jsx(v,{value:"En validación",children:"En validación"}),e.jsx(v,{value:"En pruebas",children:"En pruebas"}),e.jsx(v,{value:"Aprobado",children:"Aprobado"}),e.jsx(v,{value:"Cancelado",children:"Cancelado"})]})]})]})]})})]}),e.jsxs(b,{children:[e.jsxs(E,{children:[e.jsx(A,{children:"Equipo del Proyecto"}),e.jsx(D,{children:"Información sobre el equipo asignado"})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"pm",children:"Project Manager *"}),e.jsx(d,{id:"pm",name:"pm",value:a.pm,onChange:u,placeholder:"Nombre del PM",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"lead_dev",children:"Lead Developer *"}),e.jsx(d,{id:"lead_dev",name:"lead_dev",value:a.lead_dev,onChange:u,placeholder:"Nombre del Lead Developer",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"designer",children:"Diseñador"}),e.jsx(d,{id:"designer",name:"designer",value:a.designer,onChange:u,placeholder:"Nombre del Diseñador"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"qa_analyst_id",children:"Analista QA"}),e.jsxs(I,{value:a.qa_analyst_id,onValueChange:s=>L("qa_analyst_id",s),children:[e.jsx(R,{children:e.jsx(z,{placeholder:"Selecciona un analista"})}),e.jsxs(T,{children:[e.jsx(v,{value:"0",children:"Sin asignar"}),V.map(s=>e.jsx(v,{value:s.id.toString(),children:s.full_name},s.id))]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{children:"Desarrolladores"}),e.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:M,children:[e.jsx(k,{className:"h-4 w-4 mr-1"}),"Añadir"]})]}),a.developers.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{value:s.developer_name,onChange:r=>B(t,r.target.value),placeholder:"Nombre del desarrollador"}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",onClick:()=>H(t),disabled:a.developers.length===1,children:e.jsx(y,{className:"h-4 w-4 text-destructive"})})]},t))]})]})]}),e.jsxs(b,{children:[e.jsxs(E,{children:[e.jsx(A,{children:"Enlaces y Recursos"}),e.jsx(D,{children:"URLs y recursos relacionados con el proyecto"})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"design_url",children:"URL de Diseño"}),e.jsx(d,{id:"design_url",name:"design_url",value:a.design_url,onChange:u,placeholder:"https://figma.com/..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"test_url",children:"URL de Pruebas"}),e.jsx(d,{id:"test_url",name:"test_url",value:a.test_url,onChange:u,placeholder:"https://staging.example.com"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{children:"Recursos Adicionales"}),e.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:Q,children:[e.jsx(k,{className:"h-4 w-4 mr-1"}),"Añadir"]})]}),a.assets.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{value:s.asset_url,onChange:r=>G(t,r.target.value),placeholder:"URL del recurso"}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",onClick:()=>W(t),disabled:a.assets.length===1,children:e.jsx(y,{className:"h-4 w-4 text-destructive"})})]},t))]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(m,{variant:"outline",type:"button",asChild:!0,children:e.jsx(F,{to:`/projects/${n}`,children:"Cancelar"})}),e.jsx(m,{type:"submit",disabled:q,children:q?"Guardando...":"Guardar Cambios"})]})]})})]})};export{be as default};
