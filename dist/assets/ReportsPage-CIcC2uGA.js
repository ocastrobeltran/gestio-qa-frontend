import{f as ce,b as de,r as c,j as e,g as oe,B as M,i as b}from"./index-CROi_bFZ.js";import{C as h,a as j,b as u,c as C,d as m}from"./card-B-0H7GP8.js";import{T as xe,a as he,b as D,c as N}from"./tabs-wem10j3N.js";import{S as k,a as L,b as B,c as I,d as o}from"./select-B-rD1Ibz.js";import{L as y}from"./label-kHtJxQ_W.js";import{I as $}from"./input-BF63-rU5.js";import{T as w,a as S,b as x,c as i,d as T,e as r,S as je,F as ue}from"./table-DJPnixqN.js";import{R as E,B as q,X as K,Y as V,T as A,L as H,a as O,C as G,P as me,b as pe}from"./PieChart-oqfcXHWS.js";const fe=ce("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Q={"En análisis":"#3498db","En validación":"#f39c12","En pruebas":"#9b59b6",Aprobado:"#2ecc71",Cancelado:"#e74c3c"},Se=()=>{const{toast:P}=de(),[J,U]=c.useState(!0),[p,W]=c.useState([]),[F,Z]=c.useState([]),[R,ee]=c.useState([]),[g,se]=c.useState([]),[ae,te]=c.useState("status"),[l,X]=c.useState({status:"",client:"",analyst:"",startDate:"",endDate:""}),[v,Y]=c.useState(""),[_,z]=c.useState([]);c.useEffect(()=>{(async()=>{try{U(!0);const a=await b.getProjectsByStatus();W(a.data.data.statusReport);const t=await b.getProjectsByAnalyst();Z(t.data.data.analystReport);const n=await b.getProjectsByClient();ee(n.data.data.clientReport);const d=await b.getDetailedReport();se(d.data.data.projects),z(d.data.data.projects)}catch(a){console.error("Error fetching report data:",a),P({variant:"destructive",title:"Error",description:"No se pudieron cargar los datos de los reportes."})}finally{U(!1)}})()},[P]),c.useEffect(()=>{let s=[...g];if(l.status&&(s=s.filter(a=>a.status===l.status)),l.client&&(s=s.filter(a=>a.client===l.client)),l.analyst&&(s=s.filter(a=>{var t;return((t=a.qa_analyst)==null?void 0:t.full_name)===l.analyst||!a.qa_analyst&&l.analyst==="Sin asignar"})),l.startDate){const a=new Date(l.startDate);s=s.filter(t=>new Date(t.created_at)>=a)}if(l.endDate){const a=new Date(l.endDate);a.setHours(23,59,59,999),s=s.filter(t=>new Date(t.created_at)<=a)}if(v){const a=v.toLowerCase();s=s.filter(t=>t.title.toLowerCase().includes(a)||t.initiative.toLowerCase().includes(a)||t.client.toLowerCase().includes(a))}z(s)},[l,v,g]);const f=(s,a)=>{X(t=>({...t,[s]:a}))},le=()=>{X({status:"",client:"",analyst:"",startDate:"",endDate:""}),Y("")},ne=()=>{let s="data:text/csv;charset=utf-8,";s+=`ID,Título,Iniciativa,Cliente,Estado,Analista QA,Fecha Creación
`,_.forEach(n=>{const d=[n.id,`"${n.title.replace(/"/g,'""')}"`,`"${n.initiative.replace(/"/g,'""')}"`,`"${n.client.replace(/"/g,'""')}"`,n.status,n.qa_analyst?`"${n.qa_analyst.full_name.replace(/"/g,'""')}"`:"Sin asignar",new Date(n.created_at).toLocaleDateString()];s+=d.join(",")+`
`});const a=encodeURI(s),t=document.createElement("a");t.setAttribute("href",a),t.setAttribute("download",`reporte-proyectos-${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(t),t.click(),document.body.removeChild(t),P({title:"Reporte exportado",description:"El reporte ha sido exportado exitosamente."})};if(J)return e.jsx(oe,{fullScreen:!1});const re=Array.from(new Set(g.map(s=>s.client))),ie=Array.from(new Set(g.map(s=>s.qa_analyst?s.qa_analyst.full_name:"Sin asignar")));return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Reportes"})}),e.jsxs(xe,{defaultValue:"status",value:ae,onValueChange:te,children:[e.jsxs(he,{children:[e.jsx(D,{value:"status",children:"Por Estado"}),e.jsx(D,{value:"analyst",children:"Por Analista"}),e.jsx(D,{value:"client",children:"Por Cliente"}),e.jsx(D,{value:"detailed",children:"Detallado"})]}),e.jsxs(N,{value:"status",className:"space-y-4",children:[e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsx(u,{children:"Proyectos por Estado"}),e.jsx(C,{children:"Distribución de proyectos según su estado actual"})]}),e.jsxs(m,{className:"grid gap-4 md:grid-cols-2",children:[e.jsx("div",{children:e.jsx(E,{width:"100%",height:300,children:e.jsxs(q,{data:p,children:[e.jsx(K,{dataKey:"status"}),e.jsx(V,{allowDecimals:!1}),e.jsx(A,{}),e.jsx(H,{}),e.jsx(O,{dataKey:"project_count",name:"Proyectos",fill:"#ff5252",children:p.map((s,a)=>e.jsx(G,{fill:Q[s.status]||"#ff5252"},`cell-${a}`))})]})})}),e.jsx("div",{children:e.jsx(E,{width:"100%",height:300,children:e.jsxs(me,{children:[e.jsx(pe,{data:p,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"project_count",nameKey:"status",label:({name:s,percent:a})=>`${s}: ${(a*100).toFixed(0)}%`,children:p.map((s,a)=>e.jsx(G,{fill:Q[s.status]||"#ff5252"},`cell-${a}`))}),e.jsx(A,{})]})})})]})]}),e.jsxs(h,{children:[e.jsx(j,{children:e.jsx(u,{children:"Tabla de Proyectos por Estado"})}),e.jsx(m,{children:e.jsxs(w,{children:[e.jsx(S,{children:e.jsxs(x,{children:[e.jsx(i,{children:"Estado"}),e.jsx(i,{className:"text-right",children:"Cantidad"}),e.jsx(i,{className:"text-right",children:"Porcentaje"})]})}),e.jsx(T,{children:p.map(s=>{const a=p.reduce((n,d)=>n+d.project_count,0),t=(s.project_count/a*100).toFixed(1);return e.jsxs(x,{children:[e.jsx(r,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:Q[s.status]||"#ff5252"}}),s.status]})}),e.jsx(r,{className:"text-right",children:s.project_count}),e.jsxs(r,{className:"text-right",children:[t,"%"]})]},s.status)})})]})})]})]}),e.jsxs(N,{value:"analyst",className:"space-y-4",children:[e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsx(u,{children:"Proyectos por Analista"}),e.jsx(C,{children:"Distribución de proyectos asignados a cada analista QA"})]}),e.jsx(m,{children:e.jsx(E,{width:"100%",height:400,children:e.jsxs(q,{data:F,layout:"vertical",margin:{left:120},children:[e.jsx(K,{type:"number"}),e.jsx(V,{type:"category",dataKey:"analyst",width:120}),e.jsx(A,{}),e.jsx(H,{}),e.jsx(O,{dataKey:"count",name:"Proyectos",fill:"#ff5252"})]})})})]}),e.jsxs(h,{children:[e.jsx(j,{children:e.jsx(u,{children:"Tabla de Proyectos por Analista"})}),e.jsx(m,{children:e.jsxs(w,{children:[e.jsx(S,{children:e.jsxs(x,{children:[e.jsx(i,{children:"Analista"}),e.jsx(i,{className:"text-right",children:"Cantidad"}),e.jsx(i,{className:"text-right",children:"Porcentaje"})]})}),e.jsx(T,{children:F.map(s=>{const a=F.reduce((n,d)=>n+d.count,0),t=(s.count/a*100).toFixed(1);return e.jsxs(x,{children:[e.jsx(r,{className:"font-medium",children:s.analyst}),e.jsx(r,{className:"text-right",children:s.count}),e.jsxs(r,{className:"text-right",children:[t,"%"]})]},s.analyst)})})]})})]})]}),e.jsxs(N,{value:"client",className:"space-y-4",children:[e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsx(u,{children:"Proyectos por Cliente"}),e.jsx(C,{children:"Distribución de proyectos por cliente"})]}),e.jsx(m,{children:e.jsx(E,{width:"100%",height:400,children:e.jsxs(q,{data:R,layout:"vertical",margin:{left:120},children:[e.jsx(K,{type:"number"}),e.jsx(V,{type:"category",dataKey:"client",width:120}),e.jsx(A,{}),e.jsx(H,{}),e.jsx(O,{dataKey:"count",name:"Proyectos",fill:"#3498db"})]})})})]}),e.jsxs(h,{children:[e.jsx(j,{children:e.jsx(u,{children:"Tabla de Proyectos por Cliente"})}),e.jsx(m,{children:e.jsxs(w,{children:[e.jsx(S,{children:e.jsxs(x,{children:[e.jsx(i,{children:"Cliente"}),e.jsx(i,{className:"text-right",children:"Cantidad"}),e.jsx(i,{className:"text-right",children:"Porcentaje"})]})}),e.jsx(T,{children:R.map(s=>{const a=R.reduce((n,d)=>n+d.count,0),t=(s.count/a*100).toFixed(1);return e.jsxs(x,{children:[e.jsx(r,{className:"font-medium",children:s.client}),e.jsx(r,{className:"text-right",children:s.count}),e.jsxs(r,{className:"text-right",children:[t,"%"]})]},s.client)})})]})})]})]}),e.jsx(N,{value:"detailed",className:"space-y-4",children:e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsx(u,{children:"Reporte Detallado"}),e.jsx(C,{children:"Listado completo de proyectos con filtros avanzados"})]}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(je,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx($,{type:"search",placeholder:"Buscar por título, cliente o iniciativa...",className:"pl-8",value:v,onChange:s=>Y(s.target.value)})]}),e.jsxs(M,{variant:"outline",onClick:ne,children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),"Exportar CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"status-filter",children:"Estado"}),e.jsxs(k,{value:l.status,onValueChange:s=>f("status",s),children:[e.jsx(L,{id:"status-filter",children:e.jsx(B,{placeholder:"Todos los estados"})}),e.jsxs(I,{children:[e.jsx(o,{value:"all",children:"Todos los estados"}),e.jsx(o,{value:"En análisis",children:"En análisis"}),e.jsx(o,{value:"En validación",children:"En validación"}),e.jsx(o,{value:"En pruebas",children:"En pruebas"}),e.jsx(o,{value:"Aprobado",children:"Aprobado"}),e.jsx(o,{value:"Cancelado",children:"Cancelado"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"client-filter",children:"Cliente"}),e.jsxs(k,{value:l.client,onValueChange:s=>f("client",s),children:[e.jsx(L,{id:"client-filter",children:e.jsx(B,{placeholder:"Todos los clientes"})}),e.jsxs(I,{children:[e.jsx(o,{value:"all",children:"Todos los clientes"}),re.map(s=>e.jsx(o,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"analyst-filter",children:"Analista"}),e.jsxs(k,{value:l.analyst,onValueChange:s=>f("analyst",s),children:[e.jsx(L,{id:"analyst-filter",children:e.jsx(B,{placeholder:"Todos los analistas"})}),e.jsxs(I,{children:[e.jsx(o,{value:"all",children:"Todos los analistas"}),ie.map(s=>e.jsx(o,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"start-date",children:"Fecha Inicio"}),e.jsx($,{id:"start-date",type:"date",value:l.startDate,onChange:s=>f("startDate",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"end-date",children:"Fecha Fin"}),e.jsx($,{id:"end-date",type:"date",value:l.endDate,onChange:s=>f("endDate",s.target.value)})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(M,{variant:"outline",onClick:le,children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Limpiar Filtros"]})}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(w,{children:[e.jsx(S,{children:e.jsxs(x,{children:[e.jsx(i,{children:"ID"}),e.jsx(i,{children:"Título"}),e.jsx(i,{children:"Cliente"}),e.jsx(i,{children:"Estado"}),e.jsx(i,{children:"Analista QA"}),e.jsx(i,{children:"Fecha Creación"})]})}),e.jsx(T,{children:_.length>0?_.map(s=>{var a;return e.jsxs(x,{children:[e.jsx(r,{children:s.id}),e.jsx(r,{className:"font-medium",children:s.title}),e.jsx(r,{children:s.client}),e.jsx(r,{children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${s.status==="Aprobado"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":s.status==="Cancelado"?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300":s.status==="En pruebas"?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300":s.status==="En validación"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"}`,children:s.status})}),e.jsx(r,{children:((a=s.qa_analyst)==null?void 0:a.full_name)||"Sin asignar"}),e.jsx(r,{children:new Date(s.created_at).toLocaleDateString()})]},s.id)}):e.jsx(x,{children:e.jsx(r,{colSpan:6,className:"h-24 text-center",children:"No se encontraron proyectos con los filtros aplicados"})})})]})})]})]})})]})]})};export{Se as default};
