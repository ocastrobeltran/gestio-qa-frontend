import{e as B,u as M,b as G,r as m,j as e,B as o,L as C,v as H,p as Q}from"./index-CROi_bFZ.js";import{I as n}from"./input-BF63-rU5.js";import{L as i}from"./label-kHtJxQ_W.js";import{S as b,a as E,b as A,c as S,d as h}from"./select-B-rD1Ibz.js";import{C as j,a as v,b as x,c as g,d as y}from"./card-B-0H7GP8.js";import{A as W}from"./arrow-left-BPDy95mI.js";import{P as D}from"./plus-C9L6BQP6.js";import{T as P}from"./trash-ChFt8LWx.js";const se=()=>{const q=B(),{user:p}=M(),{toast:u}=G(),[f,N]=m.useState(!1),[L,w]=m.useState([]),[a,c]=m.useState({title:"",initiative:"",client:"",pm:"",lead_dev:"",designer:"",design_url:"",test_url:"",qa_analyst_id:"",status:"En análisis",developers:[{developer_name:""}],assets:[{asset_url:""}]});m.useEffect(()=>{(async()=>{try{const l=(await H.getUsers()).data.data.users.filter(t=>t.role==="analyst");w(l)}catch(r){console.error("Error fetching analysts:",r)}})()},[]);const d=s=>{const{name:r,value:l}=s.target;c(t=>({...t,[r]:l}))},_=(s,r)=>{c(l=>({...l,[s]:r}))},F=(s,r)=>{const l=[...a.developers];l[s].developer_name=r,c(t=>({...t,developers:l}))},I=(s,r)=>{const l=[...a.assets];l[s].asset_url=r,c(t=>({...t,assets:l}))},R=()=>{c(s=>({...s,developers:[...s.developers,{developer_name:""}]}))},U=s=>{if(a.developers.length===1)return;const r=[...a.developers];r.splice(s,1),c(l=>({...l,developers:r}))},k=()=>{c(s=>({...s,assets:[...s.assets,{asset_url:""}]}))},T=s=>{if(a.assets.length===1)return;const r=[...a.assets];r.splice(s,1),c(l=>({...l,assets:r}))},z=async s=>{if(s.preventDefault(),!a.title||!a.initiative||!a.client||!a.pm||!a.lead_dev){u({variant:"destructive",title:"Error",description:"Por favor completa todos los campos requeridos."});return}const r=a.developers.filter(t=>t.developer_name.trim()!==""),l=a.assets.filter(t=>t.asset_url.trim()!=="");try{N(!0);const t={...a,developers:r,assets:l,qa_analyst_id:a.qa_analyst_id||null,created_by:p==null?void 0:p.id},V=await Q.createProject(t);u({title:"Proyecto creado",description:"El proyecto ha sido creado exitosamente."}),q(`/projects/${V.data.data.project.id}`)}catch(t){console.error("Error creating project:",t),u({variant:"destructive",title:"Error",description:"No se pudo crear el proyecto. Inténtalo de nuevo."})}finally{N(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(o,{variant:"ghost",size:"sm",asChild:!0,className:"mr-2",children:e.jsxs(C,{to:"/projects",children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),"Volver"]})}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Crear Nuevo Proyecto"})]})}),e.jsx("form",{onSubmit:z,children:e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(j,{children:[e.jsxs(v,{children:[e.jsx(x,{children:"Información General"}),e.jsx(g,{children:"Ingresa la información básica del proyecto"})]}),e.jsx(y,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"title",children:"Título del Proyecto *"}),e.jsx(n,{id:"title",name:"title",value:a.title,onChange:d,placeholder:"Ej: Rediseño Portal Web",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"initiative",children:"Iniciativa *"}),e.jsx(n,{id:"initiative",name:"initiative",value:a.initiative,onChange:d,placeholder:"Ej: Mejora Experiencia Usuario",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"client",children:"Cliente *"}),e.jsx(n,{id:"client",name:"client",value:a.client,onChange:d,placeholder:"Ej: Empresa ABC",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"status",children:"Estado"}),e.jsxs(b,{value:a.status,onValueChange:s=>_("status",s),children:[e.jsx(E,{children:e.jsx(A,{placeholder:"Selecciona un estado"})}),e.jsxs(S,{children:[e.jsx(h,{value:"En análisis",children:"En análisis"}),e.jsx(h,{value:"En validación",children:"En validación"}),e.jsx(h,{value:"En pruebas",children:"En pruebas"}),e.jsx(h,{value:"Aprobado",children:"Aprobado"}),e.jsx(h,{value:"Cancelado",children:"Cancelado"})]})]})]})]})})]}),e.jsxs(j,{children:[e.jsxs(v,{children:[e.jsx(x,{children:"Equipo del Proyecto"}),e.jsx(g,{children:"Información sobre el equipo asignado"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"pm",children:"Project Manager *"}),e.jsx(n,{id:"pm",name:"pm",value:a.pm,onChange:d,placeholder:"Nombre del PM",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"lead_dev",children:"Lead Developer *"}),e.jsx(n,{id:"lead_dev",name:"lead_dev",value:a.lead_dev,onChange:d,placeholder:"Nombre del Lead Developer",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"designer",children:"Diseñador"}),e.jsx(n,{id:"designer",name:"designer",value:a.designer,onChange:d,placeholder:"Nombre del Diseñador"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"qa_analyst_id",children:"Analista QA"}),e.jsxs(b,{value:a.qa_analyst_id,onValueChange:s=>_("qa_analyst_id",s),children:[e.jsx(E,{children:e.jsx(A,{placeholder:"Selecciona un analista"})}),e.jsxs(S,{children:[e.jsx(h,{value:"not_assigned",children:"Sin asignar"}),L.map(s=>e.jsx(h,{value:s.id.toString(),children:s.full_name},s.id))]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Desarrolladores"}),e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:R,children:[e.jsx(D,{className:"h-4 w-4 mr-1"}),"Añadir"]})]}),a.developers.map((s,r)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{value:s.developer_name,onChange:l=>F(r,l.target.value),placeholder:"Nombre del desarrollador"}),e.jsx(o,{type:"button",variant:"ghost",size:"icon",onClick:()=>U(r),disabled:a.developers.length===1,children:e.jsx(P,{className:"h-4 w-4 text-destructive"})})]},r))]})]})]}),e.jsxs(j,{children:[e.jsxs(v,{children:[e.jsx(x,{children:"Enlaces y Recursos"}),e.jsx(g,{children:"URLs y recursos relacionados con el proyecto"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"design_url",children:"URL de Diseño"}),e.jsx(n,{id:"design_url",name:"design_url",value:a.design_url,onChange:d,placeholder:"https://figma.com/..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"test_url",children:"URL de Pruebas"}),e.jsx(n,{id:"test_url",name:"test_url",value:a.test_url,onChange:d,placeholder:"https://staging.example.com"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Recursos Adicionales"}),e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:k,children:[e.jsx(D,{className:"h-4 w-4 mr-1"}),"Añadir"]})]}),a.assets.map((s,r)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{value:s.asset_url,onChange:l=>I(r,l.target.value),placeholder:"URL del recurso"}),e.jsx(o,{type:"button",variant:"ghost",size:"icon",onClick:()=>T(r),disabled:a.assets.length===1,children:e.jsx(P,{className:"h-4 w-4 text-destructive"})})]},r))]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(o,{variant:"outline",type:"button",asChild:!0,children:e.jsx(C,{to:"/projects",children:"Cancelar"})}),e.jsx(o,{type:"submit",disabled:f,children:f?"Creando...":"Crear Proyecto"})]})]})})]})};export{se as default};
