import{f as Z,u as ee,r as d,j as e,g as se,B as te,L as K,h as ae,U as le,p as re}from"./index-CYuDxeVZ.js";import{C as r,a as c,b as n,d as i,c as C}from"./card-B2R_5Mvu.js";import{T as ce,a as ne,b as P,c as D}from"./tabs-B4dp_e8w.js";import{P as ie}from"./plus-adGqTkVZ.js";import{C as de}from"./clock-Core-fsX.js";import{A as oe,R as p,B as E,X as A,Y as k,T as b,L as S,a as T,C as B,P as xe,b as he}from"./PieChart-h40Fwi3I.js";const me=Z("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),$={"En análisis":"#3498db","En validación":"#f39c12","En pruebas":"#9b59b6",Aprobado:"#2ecc71",Cancelado:"#e74c3c"},ge=()=>{const{user:t}=ee(),[O,L]=d.useState(!0),[y,z]=d.useState([]),[j,I]=d.useState([]),[U,V]=d.useState([]),[q,F]=d.useState([]),[_,G]=d.useState([]),[M,X]=d.useState("overview"),x=(t==null?void 0:t.role)==="admin",g=(t==null?void 0:t.role)==="analyst";if(d.useEffect(()=>{(async()=>{var a,R;try{L(!0);const o=await re.getProjects();if((R=(a=o==null?void 0:o.data)==null?void 0:a.data)!=null&&R.projects){const f=o.data.data.projects;z(f);const Q=[...f].sort((h,m)=>new Date(m.updated_at).getTime()-new Date(h.updated_at).getTime()).slice(0,5);G(Q);const N={"En análisis":0,"En validación":0,"En pruebas":0,Aprobado:0,Cancelado:0},J=Object.entries(N).map(([h,m])=>({status:h,project_count:m}));if(I(J),x){const h={};f.forEach(l=>{N[l.status]=(N[l.status]||0)+1});const m=Object.entries(h).map(([l,w])=>({analyst:l,count:w}));V(m);const v={};f.forEach(l=>{l.client&&(v[l.client]=(v[l.client]||0)+1)});const W=Object.entries(v).map(([l,w])=>({client:l,count:w}));F(W)}}else console.error("Invalid response format from API:",o)}catch(o){console.error("Error fetching dashboard data:",o)}finally{L(!1)}})()},[x]),O)return e.jsx(se,{fullScreen:!1});const Y=y.length,u=y.reduce((s,a)=>(s[a.status]=(s[a.status]||0)+1,s),{}),H=g?y.filter(s=>s.qa_analyst_id===(t==null?void 0:t.id)||s.created_by===(t==null?void 0:t.id)):[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Dashboard"}),(x||g)&&e.jsx(te,{asChild:!0,children:e.jsxs(K,{to:"/projects/create",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Nuevo Proyecto"]})})]}),e.jsxs(ce,{defaultValue:"overview",value:M,onValueChange:X,children:[e.jsxs(ne,{children:[e.jsx(P,{value:"overview",children:"Resumen"}),e.jsx(P,{value:"charts",children:"Gráficos"}),e.jsx(P,{value:"recent",children:"Proyectos Recientes"})]}),e.jsxs(D,{value:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(r,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Total Proyectos"}),e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Y}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Proyectos en el sistema"})]})]}),e.jsxs(r,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"En Pruebas"}),e.jsx(de,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u["En pruebas"]||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Proyectos en fase de pruebas"})]})]}),e.jsxs(r,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Aprobados"}),e.jsx(me,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.Aprobado||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Proyectos aprobados"})]})]}),g?e.jsxs(r,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Mis Proyectos"}),e.jsx(le,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:H.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Proyectos asignados a ti"})]})]}):e.jsxs(r,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Pendientes"}),e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(u["En análisis"]||0)+(u["En validación"]||0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Proyectos pendientes de completar"})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[e.jsxs(r,{className:"col-span-4",children:[e.jsx(c,{children:e.jsx(n,{children:"Proyectos por Estado"})}),e.jsx(i,{className:"pl-2",children:e.jsx(p,{width:"100%",height:300,children:e.jsxs(E,{data:j,children:[e.jsx(A,{dataKey:"status"}),e.jsx(k,{allowDecimals:!1}),e.jsx(b,{}),e.jsx(S,{}),e.jsx(T,{dataKey:"project_count",name:"Proyectos",fill:"#ff5252",children:j.map((s,a)=>e.jsx(B,{fill:$[s.status]||"#ff5252"},`cell-${a}`))})]})})})]}),e.jsxs(r,{className:"col-span-3",children:[e.jsx(c,{children:e.jsx(n,{children:"Distribución de Estados"})}),e.jsx(i,{children:e.jsx(p,{width:"100%",height:300,children:e.jsxs(xe,{children:[e.jsx(he,{data:j,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"project_count",nameKey:"status",label:({name:s,percent:a})=>`${s}: ${(a*100).toFixed(0)}%`,children:j.map((s,a)=>e.jsx(B,{fill:$[s.status]||"#ff5252"},`cell-${a}`))}),e.jsx(b,{})]})})})]})]})]}),e.jsxs(D,{value:"charts",className:"space-y-4",children:[x&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{children:[e.jsxs(c,{children:[e.jsx(n,{children:"Proyectos por Analista"}),e.jsx(C,{children:"Distribución de proyectos asignados a cada analista QA"})]}),e.jsx(i,{className:"pl-2",children:e.jsx(p,{width:"100%",height:300,children:e.jsxs(E,{data:U,children:[e.jsx(A,{dataKey:"analyst"}),e.jsx(k,{allowDecimals:!1}),e.jsx(b,{}),e.jsx(S,{}),e.jsx(T,{dataKey:"count",name:"Proyectos",fill:"#ff5252"})]})})})]}),e.jsxs(r,{children:[e.jsxs(c,{children:[e.jsx(n,{children:"Proyectos por Cliente"}),e.jsx(C,{children:"Distribución de proyectos por cliente"})]}),e.jsx(i,{className:"pl-2",children:e.jsx(p,{width:"100%",height:300,children:e.jsxs(E,{data:q,children:[e.jsx(A,{dataKey:"client"}),e.jsx(k,{allowDecimals:!1}),e.jsx(b,{}),e.jsx(S,{}),e.jsx(T,{dataKey:"count",name:"Proyectos",fill:"#3498db"})]})})})]})]}),!x&&e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx("p",{className:"text-muted-foreground",children:"Gráficos adicionales disponibles para administradores"})})]}),e.jsx(D,{value:"recent",className:"space-y-4",children:e.jsxs(r,{children:[e.jsxs(c,{children:[e.jsx(n,{children:"Proyectos Recientes"}),e.jsx(C,{children:"Los últimos proyectos actualizados en el sistema"})]}),e.jsx(i,{children:_.length>0?e.jsx("div",{className:"space-y-4",children:_.map(s=>e.jsxs("div",{className:"flex items-center justify-between border-b pb-4 last:border-0 last:pb-0",children:[e.jsxs("div",{children:[e.jsx(K,{to:`/projects/${s.id}`,className:"font-medium hover:underline",children:s.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Cliente: ",s.client]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Actualizado: ",new Date(s.updated_at).toLocaleDateString()]})]}),e.jsx("div",{children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${s.status==="Aprobado"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":s.status==="Cancelado"?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300":s.status==="En pruebas"?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300":s.status==="En validación"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"}`,children:s.status})})]},s.id))}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-muted-foreground",children:"No hay proyectos recientes"})})})]})})]})]})};export{ge as default};
