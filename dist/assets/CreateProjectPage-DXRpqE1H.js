import{e as B,u as M,b as G,r as m,j as e,B as h,L as b,t as H,p as Q}from"./index-CYuDxeVZ.js";import{I as n}from"./input-DzyvJJh-.js";import{L as i}from"./label-Bv7pHFfe.js";import{S as E,a as A,b as S,c as D,d as c}from"./select-BERQyZpp.js";import{C as x,a as g,b as y,c as _,d as f}from"./card-B2R_5Mvu.js";import{A as W}from"./arrow-left-D5phPwFc.js";import{P as q}from"./plus-adGqTkVZ.js";import{T as P}from"./trash-DzscaxT7.js";const se=()=>{const F=B(),{user:u}=M(),{toast:v}=G(),[N,L]=m.useState(!1),[j,w]=m.useState([]),[s,d]=m.useState({title:"",initiative:"",client:"",pm:"",lead_dev:"",designer:"",design_url:"",test_url:"",qa_analyst_id:"",status:"En análisis",developers:[{developer_name:""}],assets:[{asset_url:""}]});m.useEffect(()=>{(async()=>{try{const r=await H.getUsers();console.log("User data:",r.data);const t=r.data.data.users.filter(l=>l.role==="analyst");console.log("Filtered analysts:",t),w(t)}catch(r){console.error("Error fetching analysts:",r);const t=r;t.response&&console.error("Error response data:",t.response.data)}})()},[]);const o=a=>{const{name:r,value:t}=a.target;d(l=>({...l,[r]:t}))},C=(a,r)=>{d(t=>({...t,[a]:r}))},I=(a,r)=>{const t=[...s.developers];t[a].developer_name=r,d(l=>({...l,developers:t}))},R=(a,r)=>{const t=[...s.assets];t[a].asset_url=r,d(l=>({...l,assets:t}))},U=()=>{d(a=>({...a,developers:[...a.developers,{developer_name:""}]}))},k=a=>{if(s.developers.length===1)return;const r=[...s.developers];r.splice(a,1),d(t=>({...t,developers:r}))},T=()=>{d(a=>({...a,assets:[...a.assets,{asset_url:""}]}))},z=a=>{if(s.assets.length===1)return;const r=[...s.assets];r.splice(a,1),d(t=>({...t,assets:r}))},V=async a=>{if(a.preventDefault(),!s.title||!s.initiative||!s.client||!s.pm||!s.lead_dev){v({variant:"destructive",title:"Error",description:"Por favor completa todos los campos requeridos."});return}const r=s.developers.filter(l=>l.developer_name.trim()!=="").map(l=>l.developer_name),t=s.assets.filter(l=>l.asset_url.trim()!=="").map(l=>l.asset_url);try{L(!0);const l={title:s.title,initiative:s.initiative,client:s.client,pm:s.pm,lead_dev:s.lead_dev,designer:s.designer||null,design_url:s.design_url||null,test_url:s.test_url||null,qa_analyst_id:s.qa_analyst_id==="not_assigned"?null:s.qa_analyst_id||null,status:s.status,developers:r,assets:t,created_by:u==null?void 0:u.id};console.log("Enviando datos:",l);const p=await Q.createProject(l);v({title:"Proyecto creado",description:"El proyecto ha sido creado exitosamente."}),F(`/projects/${p.data.data.project.id}`)}catch(l){console.error("Error creating project:",l);const p=l;p.response&&console.error("Error response data:",p.response.data),v({variant:"destructive",title:"Error",description:"No se pudo crear el proyecto. Inténtalo de nuevo."})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{variant:"ghost",size:"sm",asChild:!0,className:"mr-2",children:e.jsxs(b,{to:"/projects",children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),"Volver"]})}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Crear Nuevo Proyecto"})]})}),e.jsx("form",{onSubmit:V,children:e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(x,{children:[e.jsxs(g,{children:[e.jsx(y,{children:"Información General"}),e.jsx(_,{children:"Ingresa la información básica del proyecto"})]}),e.jsx(f,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"title",children:"Título del Proyecto *"}),e.jsx(n,{id:"title",name:"title",value:s.title,onChange:o,placeholder:"Ej: Rediseño Portal Web",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"initiative",children:"Iniciativa *"}),e.jsx(n,{id:"initiative",name:"initiative",value:s.initiative,onChange:o,placeholder:"Ej: Mejora Experiencia Usuario",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"client",children:"Cliente *"}),e.jsx(n,{id:"client",name:"client",value:s.client,onChange:o,placeholder:"Ej: Empresa ABC",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"status",children:"Estado"}),e.jsxs(E,{value:s.status,onValueChange:a=>C("status",a),children:[e.jsx(A,{children:e.jsx(S,{placeholder:"Selecciona un estado"})}),e.jsxs(D,{children:[e.jsx(c,{value:"En análisis",children:"En análisis"}),e.jsx(c,{value:"En validación",children:"En validación"}),e.jsx(c,{value:"En pruebas",children:"En pruebas"}),e.jsx(c,{value:"Aprobado",children:"Aprobado"}),e.jsx(c,{value:"Cancelado",children:"Cancelado"})]})]})]})]})})]}),e.jsxs(x,{children:[e.jsxs(g,{children:[e.jsx(y,{children:"Equipo del Proyecto"}),e.jsx(_,{children:"Información sobre el equipo asignado"})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"pm",children:"Project Manager *"}),e.jsx(n,{id:"pm",name:"pm",value:s.pm,onChange:o,placeholder:"Nombre del PM",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"lead_dev",children:"Lead Developer *"}),e.jsx(n,{id:"lead_dev",name:"lead_dev",value:s.lead_dev,onChange:o,placeholder:"Nombre del Lead Developer",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"designer",children:"Diseñador"}),e.jsx(n,{id:"designer",name:"designer",value:s.designer,onChange:o,placeholder:"Nombre del Diseñador"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"qa_analyst_id",children:"Analista QA"}),e.jsxs(E,{value:s.qa_analyst_id||"not_assigned",onValueChange:a=>C("qa_analyst_id",a),children:[e.jsx(A,{children:e.jsx(S,{placeholder:"Selecciona un analista"})}),e.jsxs(D,{children:[e.jsx(c,{value:"not_assigned",children:"Sin asignar"}),j&&j.length>0?j.map(a=>e.jsx(c,{value:a.id.toString(),children:a.full_name},a.id)):e.jsx(c,{value:"no_analysts",disabled:!0,children:"No hay analistas disponibles"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Desarrolladores"}),e.jsxs(h,{type:"button",variant:"outline",size:"sm",onClick:U,children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Añadir"]})]}),s.developers.map((a,r)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{value:a.developer_name,onChange:t=>I(r,t.target.value),placeholder:"Nombre del desarrollador"}),e.jsx(h,{type:"button",variant:"ghost",size:"icon",onClick:()=>k(r),disabled:s.developers.length===1,children:e.jsx(P,{className:"h-4 w-4 text-destructive"})})]},r))]})]})]}),e.jsxs(x,{children:[e.jsxs(g,{children:[e.jsx(y,{children:"Enlaces y Recursos"}),e.jsx(_,{children:"URLs y recursos relacionados con el proyecto"})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"design_url",children:"URL de Diseño"}),e.jsx(n,{id:"design_url",name:"design_url",value:s.design_url,onChange:o,placeholder:"https://figma.com/..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"test_url",children:"URL de Pruebas"}),e.jsx(n,{id:"test_url",name:"test_url",value:s.test_url,onChange:o,placeholder:"https://staging.example.com"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Recursos Adicionales"}),e.jsxs(h,{type:"button",variant:"outline",size:"sm",onClick:T,children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Añadir"]})]}),s.assets.map((a,r)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{value:a.asset_url,onChange:t=>R(r,t.target.value),placeholder:"URL del recurso"}),e.jsx(h,{type:"button",variant:"ghost",size:"icon",onClick:()=>z(r),disabled:s.assets.length===1,children:e.jsx(P,{className:"h-4 w-4 text-destructive"})})]},r))]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(h,{variant:"outline",type:"button",asChild:!0,children:e.jsx(b,{to:"/projects",children:"Cancelar"})}),e.jsx(h,{type:"submit",disabled:N,children:N?"Creando...":"Crear Proyecto"})]})]})})]})};export{se as default};
