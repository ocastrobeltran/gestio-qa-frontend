import{d as k,e as q,u as R,b as T,r as c,j as e,B as d,L as x,g as $,v as y}from"./index-CROi_bFZ.js";import{I as p}from"./input-BF63-rU5.js";import{L as u}from"./label-kHtJxQ_W.js";import{S as B,a as G,b as H,c as J,d as b}from"./select-B-rD1Ibz.js";import{C as S,a as E,b as P,c as L,d as U}from"./card-B-0H7GP8.js";import{A as _}from"./arrow-left-BPDy95mI.js";const Y=()=>{const{id:t}=k(),f=q(),{user:o,updateUser:A}=R(),{toast:i}=T(),[D,j]=c.useState(!0),[w,C]=c.useState(!1),[z,F]=c.useState(null),[s,v]=c.useState({full_name:"",email:"",role:"",password:"",confirmPassword:""}),g=(o==null?void 0:o.role)==="admin",N=(o==null?void 0:o.id)===Number(t);c.useEffect(()=>{g?(async()=>{try{j(!0);const r=(await y.getUser(t)).data.data.user;F(r),v({full_name:r.full_name,email:r.email,role:r.role,password:"",confirmPassword:""})}catch(a){console.error("Error fetching user:",a),i({variant:"destructive",title:"Error",description:"No se pudo cargar la información del usuario."}),f("/users")}finally{j(!1)}})():j(!1)},[t,g,f,i]);const m=n=>{const{name:a,value:r}=n.target;v(l=>({...l,[a]:r}))},I=n=>{v(a=>({...a,role:n}))},V=async n=>{var a,r;if(n.preventDefault(),s.password||s.confirmPassword){if(s.password!==s.confirmPassword){i({variant:"destructive",title:"Error",description:"Las contraseñas no coinciden."});return}if(s.password.length<8){i({variant:"destructive",title:"Error",description:"La contraseña debe tener al menos 8 caracteres."});return}}try{C(!0);const l={full_name:s.full_name,email:s.email,role:s.role};s.password&&(l.password=s.password);const h=await y.updateUser(t,l);N&&h.data.data.user&&A(h.data.data.user),i({title:"Usuario actualizado",description:"El usuario ha sido actualizado exitosamente."}),f(`/users/${t}`)}catch(l){console.error("Error updating user:",l);const h=((r=(a=l.response)==null?void 0:a.data)==null?void 0:r.message)||"No se pudo actualizar el usuario. Inténtalo de nuevo.";i({variant:"destructive",title:"Error",description:h})}finally{C(!1)}};return g?D?e.jsx($,{fullScreen:!1}):z?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(d,{variant:"ghost",size:"sm",asChild:!0,className:"mr-2",children:e.jsxs(x,{to:`/users/${t}`,children:[e.jsx(_,{className:"h-4 w-4 mr-1"}),"Volver"]})}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Editar Usuario"})]})}),e.jsx("form",{onSubmit:V,children:e.jsxs("div",{className:"grid gap-6 max-w-2xl mx-auto",children:[e.jsxs(S,{children:[e.jsxs(E,{children:[e.jsx(P,{children:"Información del Usuario"}),e.jsx(L,{children:"Actualiza los datos del usuario"})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"full_name",children:"Nombre Completo *"}),e.jsx(p,{id:"full_name",name:"full_name",value:s.full_name,onChange:m,placeholder:"Ej: Juan Pérez",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"email",children:"Correo Electrónico *"}),e.jsx(p,{id:"email",name:"email",type:"email",value:s.email,onChange:m,placeholder:"correo@ejemplo.com",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"role",children:"Rol *"}),e.jsxs(B,{value:s.role,onValueChange:I,disabled:N,children:[e.jsx(G,{children:e.jsx(H,{placeholder:"Selecciona un rol"})}),e.jsxs(J,{children:[e.jsx(b,{value:"admin",children:"Administrador"}),e.jsx(b,{value:"analyst",children:"Analista"}),e.jsx(b,{value:"stakeholder",children:"Stakeholder"})]})]}),N&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"No puedes cambiar tu propio rol."})]})]})]}),e.jsxs(S,{children:[e.jsxs(E,{children:[e.jsx(P,{children:"Cambiar Contraseña"}),e.jsx(L,{children:"Deja en blanco para mantener la contraseña actual"})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"password",children:"Nueva Contraseña"}),e.jsx(p,{id:"password",name:"password",type:"password",value:s.password,onChange:m,placeholder:"••••••••"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"La contraseña debe tener al menos 8 caracteres."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"confirmPassword",children:"Confirmar Nueva Contraseña"}),e.jsx(p,{id:"confirmPassword",name:"confirmPassword",type:"password",value:s.confirmPassword,onChange:m,placeholder:"••••••••"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(d,{variant:"outline",type:"button",asChild:!0,children:e.jsx(x,{to:`/users/${t}`,children:"Cancelar"})}),e.jsx(d,{type:"submit",disabled:w,children:w?"Guardando...":"Guardar Cambios"})]})]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Usuario no encontrado"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"El usuario que buscas no existe o ha sido eliminado."}),e.jsx(d,{asChild:!0,children:e.jsxs(x,{to:"/users",children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),"Volver a usuarios"]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Acceso Restringido"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"No tienes permisos para acceder a esta sección."}),e.jsx(d,{asChild:!0,children:e.jsx(x,{to:"/dashboard",children:"Volver al Dashboard"})})]})};export{Y as default};
