import{f as m,r as i,j as e,k as w,l as Q,P as Z,d as J,u as K,b as W,g as X,B as h,L as y,m as u,n as T,A as Y,o as ee,q as se,s as ae,t as A,p as P}from"./index-CROi_bFZ.js";import{C as p,a as j,b as f,d as g,c as z}from"./card-B-0H7GP8.js";import{T as te,a as re,b as N,c as b}from"./tabs-wem10j3N.js";import{A as L}from"./arrow-left-BPDy95mI.js";import{P as le}from"./pen-square-XLOe6YhH.js";import{C as ne}from"./clock-Cu56niOf.js";const ie=m("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),k=m("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),de=m("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),ce=m("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),oe=m("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),me=m("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),D=i.forwardRef(({className:r,...t},n)=>e.jsx("textarea",{className:w("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:n,...t}));D.displayName="Textarea";const xe=Q("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function he({className:r,variant:t,...n}){return e.jsx("div",{className:w(xe({variant:t}),r),...n})}var ue="Separator",q="horizontal",pe=["horizontal","vertical"],R=i.forwardRef((r,t)=>{const{decorative:n,orientation:s=q,...c}=r,x=je(s)?s:q,o=n?{role:"none"}:{"aria-orientation":x==="vertical"?x:void 0,role:"separator"};return e.jsx(Z.div,{"data-orientation":x,...o,...c,ref:t})});R.displayName=ue;function je(r){return pe.includes(r)}var I=R;const V=i.forwardRef(({className:r,orientation:t="horizontal",decorative:n=!0,...s},c)=>e.jsx(I,{ref:c,decorative:n,orientation:t,className:w("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",r),...s}));V.displayName=I.displayName;const ke=()=>{var M,S;const{id:r}=J(),{user:t}=K(),{toast:n}=W(),[s,c]=i.useState(null),[x,v]=i.useState(!0),[o,C]=i.useState(""),[_,E]=i.useState(!1),[H,O]=i.useState("details"),U=(t==null?void 0:t.role)==="admin",B=(t==null?void 0:t.role)==="analyst",F=U||B&&(s==null?void 0:s.qa_analyst_id)===(t==null?void 0:t.id);i.useEffect(()=>{(async()=>{try{v(!0);const l=await P.getProject(r);c(l.data.data.project)}catch(l){console.error("Error fetching project:",l),n({variant:"destructive",title:"Error",description:"No se pudo cargar el proyecto. Inténtalo de nuevo."})}finally{v(!1)}})()},[r,n]);const $=async a=>{if(a.preventDefault(),!!o.trim())try{E(!0);const l=await P.addComment(r,o);c(d=>d&&{...d,comments:[...d.comments||[],l.data.data.comment]}),C(""),n({title:"Comentario añadido",description:"Tu comentario ha sido añadido correctamente."})}catch(l){console.error("Error adding comment:",l),n({variant:"destructive",title:"Error",description:"No se pudo añadir el comentario. Inténtalo de nuevo."})}finally{E(!1)}};if(x)return e.jsx(X,{fullScreen:!1});if(!s)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Proyecto no encontrado"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"El proyecto que buscas no existe o ha sido eliminado."}),e.jsx(h,{asChild:!0,children:e.jsxs(y,{to:"/projects",children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Volver a proyectos"]})})]});const G=a=>{switch(a){case"Aprobado":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"Cancelado":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";case"En pruebas":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300";case"En validación":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";default:return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{variant:"ghost",size:"sm",asChild:!0,className:"mr-2",children:e.jsxs(y,{to:"/projects",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Volver"]})}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:s.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:G(s.status),children:s.status}),F&&e.jsx(h,{asChild:!0,size:"sm",children:e.jsxs(y,{to:`/projects/${s.id}/edit`,children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Editar"]})})]})]}),e.jsxs(te,{defaultValue:"details",value:H,onValueChange:O,children:[e.jsxs(re,{children:[e.jsx(N,{value:"details",children:"Detalles"}),e.jsxs(N,{value:"comments",children:["Comentarios (",((M=s.comments)==null?void 0:M.length)||0,")"]}),e.jsx(N,{value:"history",children:"Historial"})]}),e.jsx(b,{value:"details",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(p,{children:[e.jsx(j,{children:e.jsx(f,{children:"Información General"})}),e.jsx(g,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground flex items-center",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Cliente"]}),e.jsx("p",{className:"mt-1",children:s.client})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground flex items-center",children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Iniciativa"]}),e.jsx("p",{className:"mt-1",children:s.initiative})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground flex items-center",children:[e.jsx(u,{className:"mr-2 h-4 w-4"}),"Project Manager"]}),e.jsx("p",{className:"mt-1",children:s.pm})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground flex items-center",children:[e.jsx(u,{className:"mr-2 h-4 w-4"}),"Lead Developer"]}),e.jsx("p",{className:"mt-1",children:s.lead_dev})]}),s.designer&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground flex items-center",children:[e.jsx(u,{className:"mr-2 h-4 w-4"}),"Diseñador"]}),e.jsx("p",{className:"mt-1",children:s.designer})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground flex items-center",children:[e.jsx(u,{className:"mr-2 h-4 w-4"}),"Analista QA"]}),e.jsx("p",{className:"mt-1",children:((S=s.qaAnalyst)==null?void 0:S.full_name)||"Sin asignar"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground flex items-center",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Fechas"]}),e.jsxs("p",{className:"mt-1",children:["Creado: ",T(s.created_at)]}),e.jsxs("p",{className:"mt-1",children:["Actualizado: ",T(s.updated_at)]})]})]})})]}),e.jsxs(p,{children:[e.jsx(j,{children:e.jsx(f,{children:"Enlaces y Recursos"})}),e.jsxs(g,{className:"space-y-4",children:[s.design_url&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Diseño"}),e.jsxs("a",{href:s.design_url,target:"_blank",rel:"noopener noreferrer",className:"mt-1 flex items-center text-primary hover:underline",children:[s.design_url,e.jsx(k,{className:"ml-1 h-3 w-3"})]})]}),s.test_url&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"URL de Pruebas"}),e.jsxs("a",{href:s.test_url,target:"_blank",rel:"noopener noreferrer",className:"mt-1 flex items-center text-primary hover:underline",children:[s.test_url,e.jsx(k,{className:"ml-1 h-3 w-3"})]})]}),s.developers&&s.developers.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Desarrolladores"}),e.jsx("ul",{className:"space-y-1",children:s.developers.map(a=>e.jsx("li",{children:a.developer_name},a.id))})]}),s.assets&&s.assets.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Recursos"}),e.jsx("ul",{className:"space-y-1",children:s.assets.map(a=>e.jsx("li",{children:e.jsxs("a",{href:a.asset_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-primary hover:underline",children:["Recurso ",a.id,e.jsx(k,{className:"ml-1 h-3 w-3"})]})},a.id))})]})]})]})]})}),e.jsx(b,{value:"comments",className:"space-y-4",children:e.jsxs(p,{children:[e.jsxs(j,{children:[e.jsx(f,{children:"Comentarios"}),e.jsx(z,{children:"Discusión sobre el proyecto"})]}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-4",children:[s.comments&&s.comments.length>0?e.jsx("div",{className:"space-y-4",children:s.comments.map(a=>{var l,d;return e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs(Y,{className:"h-10 w-10",children:[e.jsx(ee,{src:"/placeholder.svg",alt:((l=a.author)==null?void 0:l.full_name)||"Usuario"}),e.jsx(se,{children:a.author?ae(a.author.full_name):"U"})]}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:((d=a.author)==null?void 0:d.full_name)||"Usuario"}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:A(a.created_at)})]})}),e.jsx("p",{className:"text-sm",children:a.comment_text})]})]},a.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(oe,{className:"mx-auto h-12 w-12 text-muted-foreground opacity-50"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"No hay comentarios aún"})]}),e.jsx(V,{className:"my-4"}),e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsx(D,{placeholder:"Escribe un comentario...",value:o,onChange:a=>C(a.target.value),className:"min-h-[100px]"}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(h,{type:"submit",disabled:_||!o.trim(),children:[_?"Enviando...":"Enviar comentario",e.jsx(me,{className:"ml-2 h-4 w-4"})]})})]})]})})]})}),e.jsx(b,{value:"history",className:"space-y-4",children:e.jsxs(p,{children:[e.jsxs(j,{children:[e.jsx(f,{children:"Historial de Cambios"}),e.jsx(z,{children:"Registro de modificaciones del proyecto"})]}),e.jsx(g,{children:s.history&&s.history.length>0?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-4 top-0 bottom-0 w-0.5 bg-border"}),e.jsx("ul",{className:"space-y-4",children:s.history.map(a=>{var l;return e.jsxs("li",{className:"relative pl-8",children:[e.jsx("div",{className:"absolute left-0 top-2 h-4 w-4 rounded-full bg-primary"}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx("span",{className:"font-medium",children:((l=a.changer)==null?void 0:l.full_name)||"Usuario"}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:A(a.timestamp)})]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:a.change_type}),a.old_value&&a.new_value&&e.jsxs(e.Fragment,{children:[": de ",e.jsx("span",{className:"italic",children:a.old_value})," a"," ",e.jsx("span",{className:"italic",children:a.new_value})]})]})]})]},a.id)})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ce,{className:"mx-auto h-12 w-12 text-muted-foreground opacity-50"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"No hay historial de cambios"})]})})]})})]})]})};export{ke as default};
